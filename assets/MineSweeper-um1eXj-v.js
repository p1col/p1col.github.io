import{d as I,e as d,b as k,i as P,c as g,a as f,w as b,j as w,g as r,t as V,F as $,f as E,o as _,n as q,k as B}from"./index-Dq-nUbL_.js";const A={class:"mine-config"},L=f("label",{for:"row",class:"mine-config__label"},"行：",-1),N=f("label",{for:"col",class:"mine-config__label"},"列：",-1),T=f("label",{for:"count",class:"mine-config__label"},"雷数量：",-1),H=["max"],J={class:"game-status"},K={class:"mine-map"},Q=["onClick","onContextmenu"],ne=I({__name:"MineSweeper",setup(W){let c=d(!1),i=d({x:16,y:16,mines:40}),R=k(()=>i.value.x*i.value.y),m=new Set,a=d([]),x=d(i.value.mines),y=d(i.value.x*i.value.y),h=k(()=>!c.value&&y.value===i.value.mines);const F=e=>Math.floor(Math.random()*e),C=e=>e-1<0?e:e-1,Y=(e,n)=>e+1===n?e:e+1;function M(e){if(e<=0)return;const n=F(i.value.x),s=F(i.value.y);m.has("".concat(n,"-").concat(s))?M(e):(m.add("".concat(n,"-").concat(s)),M(e-1))}function j(e,n,s){if(e===0&&n===0)return 0;let t=C(e),l=C(n),o=Y(n,i.value.y),u=0;for(;t<=e;){let v=l;for(;t<e&&v<=o||v<n;)!s&&a.value[t][v].isMine&&u++,s&&!a.value[t][v].isMine&&a.value[t][v].mines++,v++;t++}return u}function S(){for(let e=0;e<i.value.x;e++)for(let n=0;n<i.value.y;n++){const s=m.has("".concat(e,"-").concat(n));a.value[e]||(a.value[e]=[]),a.value[e][n]={x:e,y:n,isMine:s,isFlag:!1,isOpen:!1,mines:j(e,n,s)}}}function O(){a.value&&(a.value.length=0,a.value=new Array(i.value.x)),m.size>0&&m.clear(),x.value=i.value.mines,y.value=i.value.x*i.value.y,M(i.value.mines),S(),c.value=!1}function U(){a.value.forEach(e=>e.forEach(n=>n.isOpen=!0))}P(()=>h.value,e=>{if(e&&x.value>0)for(const n of m){const[s,t]=n.split("-");a.value[+s][+t].isFlag=!0}});let p=[];const X=[[-1,0],[-1,1],[0,1],[1,1],[1,0],[1,-1],[0,-1],[-1,-1]];function z(e,n){for(p.push({x:e,y:n});p.length>0;){const{x:s,y:t}=p[0];if(a.value[s][t].isOpen=!0,y.value--,a.value[s][t].isVisit=!0,p.shift(),a.value[s][t].mines===0)for(const l of X){let o=s+l[0],u=t+l[1];(o>=0&&o<i.value.x&&u>=0&&u<i.value.y?!(a.value[o][u].isOpen||a.value[o][u].isVisit||a.value[o][u].isFlag):!1)&&(a.value[o][u].isVisit=!0,p.push({x:o,y:u}))}}}function D(e){e.isFlag||e.isOpen||c.value||h.value||(e.isOpen=!0,e.isMine?(c.value=!0,e.isExplode=!0,U()):e.mines===0?z(e.x,e.y):y.value--)}function G(e){if(!(c.value||h.value))return e.isFlag=!e.isFlag,x.value+=e.isFlag?-1:1,!1}return O(),(e,n)=>(_(),g($,null,[f("div",A,[L,b(f("input",{id:"row",class:"mine-config__input",type:"number","onUpdate:modelValue":n[0]||(n[0]=s=>r(i).x=s)},null,512),[[w,r(i).x]]),N,b(f("input",{id:"col",class:"mine-config__input",type:"number","onUpdate:modelValue":n[1]||(n[1]=s=>r(i).y=s)},null,512),[[w,r(i).y]]),T,b(f("input",{id:"count",type:"number",class:"mine-config__input","onUpdate:modelValue":n[2]||(n[2]=s=>r(i).mines=s),max:r(R)},null,8,H),[[w,r(i).mines]]),f("button",{class:"mine-config__btn",onClick:O},"Play")]),f("div",J,V(r(h)?"ψ(｀∇´)ψ 通关！":"ψ(._. )> 剩余标记数：".concat(r(x))),1),f("div",K,[(_(!0),g($,null,E(r(a),(s,t)=>(_(),g("div",{class:"mine-row",key:"row-".concat(t)},[(_(!0),g($,null,E(s,(l,o)=>(_(),g("div",{class:q(["mine-cell",["color-".concat(l.mines),{"is-mine":l.isMine,"mine-cell--flag":l.isFlag,"mine-cell--open":l.isOpen,"mine-cell--explode":l.isExplode}]]),key:"cell-".concat(t,"-").concat(o),onClick:B(u=>D(l),["left"]),onContextmenu:B(u=>G(l),["prevent"])},V(l.mines||""),43,Q))),128))]))),128))])],64))}});export{ne as default};
